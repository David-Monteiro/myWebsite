<!DOCTYPE html>
<html>
<head>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body ng-app="app" ng-controller="PostsCtrl">

	<div class="container">
		<h1>Posts</h1>
		<input ng-model="postBody" class"form-control" />
		<button ng-click="addPost()" class="btn btn-default"> Add Posts </button>
		<ul class="list-group">
			<li class="list-group-item" ng-repeat='post in posts'>
				<strong>{{post.username}}</strong>
				<span>{{post.body}}</span>
			</li>
		</ul>
	</div>


	<!-- Scripts -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
	<script>
		var app = angular.module('app', []);
		/*app.config(['$qProvider', function($qProvider) {
		     $qProvider.errorOnUnhandledRejections(false);
		 }]);*/
		app.controller('PostsCtrl', function($scope, $http){

			$scope.addPost = function(){		
				/*$scope.companies.push({ 'name':$scope.name, 'employees': $scope.employees, 'headoffice':$scope.headoffice });*/
				// Writing it to the server
				//		
				if($scope.postBody) {
					var post = {
						username : "david",
						body : $scope.postBody
					};
					console.log("POST: 1st step");
					var res = $http.post('/api/posts', post)
					.then( function(data, status, headers, config) {
						console.log("POST: success");
					}, 
					function(data, status, headers, config) {
						console.error('POST: Error');
					});		
					// Making the field empty
					//
					$scope.body=null;
				}
			};

			$http.get('/api/posts')
			.then(function(posts){
				$scope.posts = posts;
				console.log("GET: success");
			}, 
			function(data, status, headers, config) {
				console.log('GET: Error');
			});		
			


			/*$http.get('http://localhost:3000/api/posts')
				.success(function (posts) {
				$scope.posts = posts;
			});*/

			/********************$http({
				method: 'GET',
				url: '/api/posts'
				}).then(function successCallback(posts) {
					$scope.posts = posts;
					console.log("status:" + posts.status);
				console.log("status:" + posts.status);
				}, function errorCallback(posts) {
					console.error('Error occurred:', posts.status, posts.data);
			});//////////////////*/

			/*$http.get('/api/posts').then(function (posts){
				$scope.posts = posts;
				console.log("status:" + posts.status);
			}).catch(function(posts) {
				console.error('Error occurred:', posts.status, posts.data);
			}).finally(function() {
				console.log("Task Finished.");
			});*/
			/*$http.get('/api/posts')
  			.then(function(posts){ $scope.posts = posts; });*/

		});

/*
				app.controller('PostsCtrl', function($scope, $http){
			$scope.posts = [
				{
					username: 'david something',
					body: '1st post'
				},
				{
					username: 'something monteiro',
					body: '2nd post'
				}
			],
			$scope.addPost = function () {
				if($scope.postBody){
					$scope.posts.unshift({
						username: "david monteiro",
						body: $scope.postBody
					})
				}
				$scope.postBody = null;

			},
			$http.get('http://localhost:3000/api/posts')
				.success(function (posts) {
				$scope.posts = posts;
			});

		});

*/


	</script>
</body>
</html>